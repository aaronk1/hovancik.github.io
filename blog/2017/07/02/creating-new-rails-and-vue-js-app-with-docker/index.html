<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Creating new Rails and Vue.js app with Docker</title>
      <meta name="description" content="Jan Hovancik, software developer - guitar player - poetry lover">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta property="og:image" content='http://hovancik.net/img/wood-817459_1280.jpg'/>
      <link href='//fonts.googleapis.com/css?family=Tienne:700,400|Poiret+One|Roboto:300,400' rel='stylesheet' type='text/css'>
      <link href="http://hovancik.net/blog/feed.xml" rel="alternate" title="RSS" type="application/rss+xml" />
      <link href="../../../../../css/normalize.css" rel="stylesheet" />
      <link href="../../../../../css/main.css" rel="stylesheet" />
      <link href="../../../../../img/favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body>

          <div class="blog">
      <div class="blog__nav">
        <p>
          <a href="/">hovancik.net</a>/<a href="/blog">blog</a>/
        </p>
      </div>
        <article>
    <div>
      <h1>
        <a href="">Creating new Rails and Vue.js app with Docker</a>
      </h1>
      <p>
        <small>Posted under
          <a href="/blog/tags/ruby/">ruby</a>
                    <a href="/blog/tags/rails/">rails</a>
                    <a href="/blog/tags/docker/">docker</a>
                    <a href="/blog/tags/vuejs/">vuejs</a>
           on
          <time>Jul  2 2017</time>
        </small>
      </p>
    </div>
    <div class="center">
      &middot;
    </div>
    <div class="article_text">
    <p>The most of Rails and Docker tutorials either show how to <a href="https://semaphoreci.com/community/tutorials/dockerizing-a-ruby-on-rails-application">dockerize</a> your existing app, or how to create new Rails app by <a href="https://blog.codeship.com/running-rails-development-environment-docker/">installing Rails</a> locally and then adding Docker as second step.</p>

<p>It works but it have always struck me as weird idea: <em>why installing Ruby first</em>? Isn't the point of Docker, at least in part, that I do not need Ruby locally?</p>

<p>I am not that familiar with Docker so I decided to figure this out. <a href="https://vuejs.org/">Vue.js</a> included, as it's something I want to try out and there's not a lot of stuff about it out there.</p>

<p>The result should be <strong>basic example of Vue.js and Rails app running inside Docker container</strong>. And for that, I'd like to use <a href="https://github.com/rails/webpacker">webpacker</a> gem. One more thing: no <a href="http://coffeescript.org/">CoffeeScript</a> (which is default for Rails).</p>

<p><em>I recommend to familiarize yourself with Docker and webpacker, if not already. I am not gonna talk about them a lot.</em></p>

<h2 id="no-local-ruby-and-rails">No local Ruby and Rails</h2>

<p>As it turns out, it's not that hard.</p>

<p>All I needed to do is go to the official Docker's <a href="https://docs.docker.com/compose/rails/#define-the-project">Rails example</a>. The document shows how to create new Rails app with PostgreSQL database without need to have Rails or Ruby installed on local machine.</p>

<p>Adding Vue.js to the mix changes steps a bit and that's what I will be writing about.</p>

<h2 id="docker-container">Docker container</h2>

<p>To be able to create new app, we first need to prepare Docker container that can run <code>rails new fancyapp --force --database=postgresql --webpack=vue --skip-coffee</code> command. For that we need to have Rails so feel free to initialize your git repo and create basic <code>Gemfile</code>.</p>

<pre><code class="language-ruby">source 'https://rubygems.org'
ruby '2.4.1'
gem 'rails', '~&gt; 5.1', '&gt;= 5.1.1'
</code></pre>

<p><code>Gemfile.lock</code> is empty at this point.</p>

<p>Now let's install other dependencies via <code>Dockerfile</code>.</p>
<pre><code>FROM ruby:2.4.1

RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential libpq-dev

# Node.js
RUN curl -sL https://deb.nodesource.com/setup_7.x | bash - \
&amp;&amp; apt-get install -y nodejs

RUN apt-get update &amp;&amp; apt-get install -y curl apt-transport-https wget &amp;&amp; \
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - &amp;&amp; \
echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list &amp;&amp; \
apt-get update &amp;&amp; apt-get install -y yarn

RUN mkdir /fancyapp
WORKDIR /fancyapp

ADD Gemfile /fancyapp/Gemfile
ADD Gemfile.lock /fancyapp/Gemfile.lock

RUN bundle install

ADD . /fancyapp
</code></pre>
<p>This is pretty straightforward: we install PostgreSQL lib, Node.js and yarn. Then we create directory for our fancy app and add <code>Gemfile</code> and <code>Gemfile.lock</code> there. Bundle will install Rails so we can use it to create new app.</p>

<p>Think about your app name here, and name the folder accordingly. Rails app will get name from it.</p>

<p>One last thing is <code>docker-compose.yml</code>. We will use <code>docker-compose</code> to run Docker commands.</p>

<pre><code>version: '3'
services:
  db:
    image: postgres
  web:
    build: .
    command: bundle exec rails s -p 3000 -b '0.0.0.0'
    volumes:
      - .:/fancyapp
    ports:
      - "3000:3000"
    depends_on:
      - db
</code></pre>

<h2 id="rails-new-fancyapp">rails new fancyapp</h2>

<p>Now that we are all ready, we need to call <code>docker-compose build</code>. Rails and all deps will get installed, so we can <code>docker-compose run web rails new . --force --database=postgresql --webpack=vue --skip-coffee</code> to create new app.</p>

<p>We do not set application name in <code>rails new</code> command, as we are calling it from inside our app directory. In our case the app will be called <em>fancyapp</em>.</p>

<p>The command mentioned will generate new app with example Vue.js code that we will use later. If you're running on Linux, the newly created files might be owned by root. To be able to work with them, run this:</p>
<pre><code>sudo chown -R $USER:$USER .
</code></pre>

<p>Then every time when you create files with <code>docker-compose run ...</code>, do it again.</p>

<p>Do not forget to add <code>ruby '2.4.1'</code> to Gemfile again. It gets removed when using <code>--force</code>.</p>

<p>Now you can run <code>docker-compose build</code> again and <code>docker-compose up</code>. Your app is available at <code>localhost:3000</code>.</p>

<h2 id="adding-vuejs">Adding Vue.js</h2>

<p>The app running right now is ready to run Vue.js code, but our container is not. Let's change that.</p>

<p>To make things easier, we will add <a href="https://github.com/ddollar/foreman">Foreman</a> first. For dev environment, we can have <code>Procfile.dev</code>, to say what we want to run when app starts.</p>

<pre><code>web: bundle exec rails s -p 3000 -b '0.0.0.0'
webpacker: bundle exec bin/webpack-dev-server
</code></pre>

<p>Fot this to work we need to update <code>docker-compose.yml</code>.</p>

<pre><code>version: '3'
services:
  db:
    image: postgres
  web:
    build: .
    command: bundle exec foreman start -f Procfile.dev
    volumes:
      - .:/titbitoutfit
    ports:
      - "3000:3000"
      - "8080:8080"
    depends_on:
      - db
</code></pre>
<p>We now have new command to run Foreman and we added port 8080 for webpack-dev-server. You can do <code>docker-compose build &amp;&amp; docker-compose run</code> to test it out.</p>

<p>All that is left now is adding some Vue.js code.</p>

<p>The easiest way is to add simple page via Rails generator: <code>docker-compose run web bundle exec rails g controller home index</code>. We will only change the Index view by adding example Vue.js code generated in the beginning via <code>javascript_pack_tag</code> that will execute code in <code>app/javascript/packs/hello_vue.js</code>.</p>

<pre><code>&lt;h1&gt;&lt;%= javascript_pack_tag 'hello_vue' %&gt;&lt;/h1&gt;
</code></pre>

<p>Go <code>up</code> with your container and you should see <em>Hello Vue!</em> in your browser.</p>

<p>Congratz, you have Rails with Vue.js app!</p>

<h2 id="debugging">Debugging</h2>

<p>If you run into any issue (eg. container wont start), it might be helpful to try to run commands not via <code>docker-compose up</code>, but via <code>docker-compose run ...</code>. This way you may get better error output.</p>

<p>One might <code>docker-compose run web bundle exec rails s -p 3000 -b '0.0.0.0'</code> to check whether there is something wrong with Rails starting up.</p>

<p>I had to do that to figure out that pid file of my Rails app was not deleted when container went down.</p>
<h2 id="next-steps">Next steps</h2>

<p>The <code>rails new</code> generated example Vue.js stuff for us, but that's just the start.</p>

<p>As I am not familiar with Vue.js, my next step is doing exactly that. Then I will need to learn more about webpacker. With that knowledge I hope to be able to fully use all the goods that this setup is giving me.</p>

    </div>
    <div class="center">
      &middot;
    </div>
    <p class="social">
      Did you enjoy this? Copy-paste the link from the address bar
      to your favourite social network to share. Subscribe
      <a href="//feeds.feedburner.com/JanHovancik">here</a>.
    </p>
    <div class="center">
      &middot;
    </div>
    <div id='disqus_thread'></div>
<script type='text/javascript'>
//<![CDATA[
                  var disqus_shortname = 'hovancik';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
<a href='http://disqus.com' class='dsq-brlink'>comments powered by <span class='logo-disqus'>Disqus</span></a>

    <div class="center">
      &middot;
    </div>
  </article>

    </div>
    <footer>
      <p class="footer__name"><a href="/">Jan Hovancik</a> 2014+</p>
      <p class="footer__desc">
        software developer - guitar player - poetry lover
      </p>
    </footer>
    <div class="center">
      &middot;
    </div>


      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-45739616-1', 'auto');
        ga('require', 'displayfeatures');
        ga('send', 'pageview');
      </script>
  </body>
</html>
