<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Introducing mina-supervisord gem</title>
      <meta name="flattr:id" content="en32oj">
      <meta name="description" content="Jan Hovancik, software developer - guitar player - poetry lover">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta property="og:image" content='http://hovancik.net/img/wood-817459_1280.jpg'/>
      <link href='//fonts.googleapis.com/css?family=Tienne:700,400|Poiret+One|Roboto:300,400' rel='stylesheet' type='text/css'>
      <link href="http://hovancik.net/blog/feed.xml" rel="alternate" title="RSS" type="application/rss+xml" />
      <link href="../../../../../css/normalize.css" rel="stylesheet" />
      <link href="../../../../../css/main.css" rel="stylesheet" />
      <link href="../../../../../img/favicon.ico" rel="icon" type="image/ico" />
      <!-- Matomo -->
      <script type="text/javascript">
        var _paq = _paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
          var u="//stats.hovancik.net/";
          _paq.push(['setTrackerUrl', u+'piwik.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
      </script>
      <!-- End Matomo Code -->
  </head>
  <body>

          <div class="blog">
      <div class="blog__nav">
        <p>
          <a href="/">hovancik.net</a>/<a href="/blog">blog</a>/
        </p>
      </div>
        <article>
    <div>
      <h1>
        <a href="">Introducing mina-supervisord gem</a>
      </h1>
      <p>
        <small>Posted under
          <a href="/blog/tags/ruby/">ruby</a>
                    <a href="/blog/tags/gem/">gem</a>
                    <a href="/blog/tags/mina/">mina</a>
                    <a href="/blog/tags/supervisord/">supervisord</a>
                    <a href="/blog/tags/mina-supervisord/">mina-supervisord</a>
           on
          <time>Jun 22 2017</time>
        </small>
      </p>
    </div>
    <div class="center">
      &middot;
    </div>
    <div class="article_text">
    <p>Hi there,</p>

<p>I'm happy to announce the first release of gem <a href="https://github.com/hovancik/mina-supervisord">mina-supervisord</a>.</p>

<p>Mina::Supervisord is a <a href="http://supervisord.org/">Supervisor</a> (process control system) wrapper for <a href="https://github.com/mina-deploy/mina">mina</a>.</p>

<h2 id="installation">Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<pre><code class="language-ruby">gem 'mina-supervisord', require: false
</code></pre>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<p>Or install it yourself as:</p>

<pre><code>$ gem install mina-supervisord
</code></pre>

<h2 id="usage">Usage</h2>

<p>To restart your app during deploy you might add this to <code>deloy.rb</code>:</p>

<pre><code class="language-ruby">require 'mina/supervisord'

task deploy: :environment do
  deploy do
    ...
    on :launch do
      invoke :'supervisord:restart', 'puma'
    end
  end
end
</code></pre>
<p>To call it as mina task, eg. to start your puma, you would run this from command line:</p>

<pre><code class="language-ruby">bundle exec mina supervisord:start['puma']

</code></pre>

<p><code>puma</code> is a supervisord <a href="http://supervisord.org/running.html#adding-a-program">program</a>.</p>

<h3 id="supported-tasks">Supported tasks</h3>
<ul>
  <li><code>supervisord:restart</code>- to restart a program (eg. <code>bundle exec mina supervisord:restart['program']</code>)</li>
  <li><code>supervisord:start</code>- to start a program (eg. <code>bundle exec mina supervisord:start['program']</code>)</li>
  <li><code>supervisord:stop</code>- to stop a program (eg. <code>bundle exec mina supervisord:stop['program']</code>)</li>
  <li><code>supervisord:status</code>- to get status of a program (eg. <code>bundle exec mina supervisord:status['program']</code>)</li>
  <li><code>supervisord:signal</code>- to send a signal to a program (eg. <code>bundle exec mina supervisord:signal['program,signal']</code>)
    <h4 id="extra-tasks">Extra tasks</h4>
  </li>
  <li><code>supervisord:signal:or_start</code>- to send a signal to a program, or start it if not running (eg. <code>bundle exec mina supervisord:signal:or_start['program,signal']</code>)</li>
  <li><code>supervisord:restart:or_start</code>- to restart a program, or start it if not running (eg. <code>bundle exec mina supervisord:restart:or_start['program']</code>)</li>
</ul>

<p>You might find these extra tasks useful when you are not sure whether your program is running.</p>

<p>Eg. when we do our deploy, we want our <code>puma</code> server to be restarted or started if not running already. To do that, we have following in our <code>deploy.rb</code>:</p>

<pre><code class="language-ruby">desc "Phased restart of the application"
task :phased_restart =&gt; :environment do
  invoke :'supervisord:signal:or_start', fetch(:application_supervisor_file), "SIGUSR1"
end
</code></pre>

<h2 id="contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at https://github.com/hovancik/mina-supervisord. This project is intended to be a safe, welcoming space for collaboration, and contributors are expected to adhere to the <a href="http://contributor-covenant.org">Contributor Covenant</a> code of conduct.</p>

<p>Development of this gem is sponsored by <a href="http://mix.it">Mix.it</a>.</p>

<h2 id="license">License</h2>

<p>The gem is available as open source under the terms of the <a href="http://opensource.org/licenses/MIT">MIT License</a>.</p>

    </div>
    <div class="center">
      &middot;
    </div>
    <p class="social">
      Did you enjoy this? Copy-paste the link from the address bar
      to your favourite social network to share. Subscribe
      <a href="//feeds.feedburner.com/JanHovancik">here</a>.
    </p>
    <div class="center">
      &middot;
    </div>
    <div id='disqus_thread'></div>
<script type='text/javascript'>
//<![CDATA[
                  var disqus_shortname = 'hovancik';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
<a href='http://disqus.com' class='dsq-brlink'>comments powered by <span class='logo-disqus'>Disqus</span></a>

    <div class="center">
      &middot;
    </div>
  </article>

    </div>
    <footer>
      <p class="footer__name"><a href="/">Jan Hovancik</a> 2014+</p>
      <p class="footer__desc">
        software developer - guitar player - poetry lover
      </p>
    </footer>
    <div class="center">
      &middot;
    </div>


  </body>
</html>
