<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Learning how to work with Heroku Buildpacks and Node app</title>
      <meta name="description" content="Jan Hovancik, software developer - guitar player - poetry lover">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta property="og:image" content='http://hovancik.net/img/wood-817459_1280.jpg'/>
      <link href='//fonts.googleapis.com/css?family=Tienne:700,400|Poiret+One|Roboto:300,400' rel='stylesheet' type='text/css'>
      <link href="http://hovancik.net/blog/feed.xml" rel="alternate" title="RSS" type="application/rss+xml" />
      <link href="../../../../../css/normalize.css" rel="stylesheet" />
      <link href="../../../../../css/main.css" rel="stylesheet" />
      <link href="../../../../../img/favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body>

          <div class="blog">
      <div class="blog__nav">
        <p>
          <a href="/">hovancik.net</a>/<a href="/blog">blog</a>/
        </p>
      </div>
        <article>
    <div>
      <h1>
        <a href="">Learning how to work with Heroku Buildpacks and Node app</a>
      </h1>
      <p>
        <small>Posted under
          <a href="/blog/tags/heroku/">heroku</a>
                    <a href="/blog/tags/buildpack/">buildpack</a>
                    <a href="/blog/tags/node/">node</a>
           on
          <time>Feb 18 2016</time>
        </small>
      </p>
    </div>
    <div class="center">
      &middot;
    </div>
    <div class="article_text">
    <p>Few days ago I started to work on new task: deployment of the front-end <a href="https://nodejs.org/en/">Node</a> app to <a href="https://heroku.com/">Heroku</a>.</p>

<p>I am not familiar with it, so what could go wrong? No worries, I have colleagues with more experience, so let's call it <em>time to learn</em>.</p>

<h3 id="first-things-first">First things first.</h3>

<p>I have some basic experience with Heroku and <a href="https://www.ruby-lang.org/en/">Ruby</a>, so I started with <em>getting-to-know</em> questions.</p>

<p>What kind of app it is? How does the current deployment works? Are there any assets? How much does Heroku likes Node? <em>What the fuck?</em></p>

<h3 id="answers">Answers.</h3>

<pre><code>var express = require('express');
</code></pre>
<p>Seems like it's an <a href="http://expressjs.com/">Express</a> app. No experience with that, but I would say that it's something that wont complicate anything and I pretty much don't need to care about what framework are we having here. So let's move on.</p>

<p>I created app via Heroku dashboard and then added remote called <code>heroku</code>.  <code>git push heroku feature/heroku:master</code> and:</p>

<pre><code>-----&gt; Node.js app detected
-----&gt; Creating runtime environment
.
.
.
-----&gt; Discovering process types
       Procfile declares types     -&gt; (none)
       Default types for buildpack -&gt; web
-----&gt; Launching...
</code></pre>

<p>But the app is not running. That would be too easy.</p>

<h3 id="buildpacks">Buildpacks</h3>
<p>Going back to app files and searching for deploy brought me to <code>Gruntfile.js</code>. From their website I decided that <a href="http://gruntjs.com/">Grunt</a> is kinda like doing Rake task in Rails world.  Googling Grunt and Heroku brought me <a href="https://devcenter.heroku.com/articles/buildpacks">buildpacks</a>.  Those are basically collections of scripts that prepare your code to run on your app's dyno. Nice thing is that you can fork the default ones that Heroku prepared and customize it for your app. Colleagues to help!</p>

<p>So I went with the first one containing word Grunt. Following the instructions<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, I created grunt task called <code>heroku:production</code><sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> as that's what will run when deploying app.</p>

<p>Deploy.</p>

<pre><code>-----&gt; Found Gruntfile, running grunt build task
Loading "Gruntfile.js" tasks...ERROR
&gt;&gt; Error: Cannot find module 'flat'
</code></pre>

<p>Where's flat? In <code>devDependencies</code>. Not really caring what it does, but at least now I know that Node makes difference between production and development dependencies and that they wont get installed on Heroku. But we know that we can fix that in buildpack, right?</p>

<h3 id="forking">Forking.</h3>

<p>First thing I've tried was copying all the dev deps to production. (By doing that I also found out that I need <a href="http://bower.io/">bower</a> and <a href="http://compass-style.org/">compass</a>). Buildpacks that I tried didn't work, so in the end I decided to combine partially working ones and fork it into new <a href="https://github.com/6artisans/heroku-buildpack-nodejs-grunt-compass-bower">one</a>. Then we can figure out how to install dev deps on Heroku.</p>

<p>To install bower I committed <a href="https://github.com/6artisans/heroku-buildpack-nodejs-grunt-compass-bower/commit/ada3b2198e46a6b55e96df82cd68fffe957dcbf8">this</a>. It seems that installing dev deps ain't that <a href="https://github.com/6artisans/heroku-buildpack-nodejs-grunt-compass-bower/commit/9ea92e7189f1064a579b8cd234c4f0cde8e64655">hard</a>, too.</p>

<h3 id="yay-moment"><em>Yay!</em> moment.</h3>

<pre><code>Done, without errors.
Total 26.5s
-----&gt; Discovering process types
       Procfile declares types -&gt; web
-----&gt; Compressing... done, 70.1MB
-----&gt; Launching...
       Released v20
</code></pre>

<p>Trial-Error took <em>only</em> 20 deploys, mission completed.</p>

<p>Now I know more about buildpacks, node and Heroku, compass, Grunt, Bower and bash.</p>

<p>Let's not forget bash.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Sorry, I don't remember which one it was.&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Task was the same as was used previously when deploying on custom server (building assets etc.), except things related to installing software on server.&nbsp;<a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>
    <div class="center">
      &middot;
    </div>
    <p class="social">
      Did you enjoy this? Copy-paste the link from the address bar
      to your favourite social network to share. Subscribe
      <a href="//feeds.feedburner.com/JanHovancik">here</a>.
    </p>
    <div class="center">
      &middot;
    </div>
    <div id='disqus_thread'></div>
<script type='text/javascript'>
//<![CDATA[
                  var disqus_shortname = 'hovancik';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
<a href='http://disqus.com' class='dsq-brlink'>comments powered by <span class='logo-disqus'>Disqus</span></a>

    <div class="center">
      &middot;
    </div>
  </article>

    </div>
    <footer>
      <p class="footer__name"><a href="/">Jan Hovancik</a> 2014+</p>
      <p class="footer__desc">
        software developer - guitar player - poetry lover
      </p>
    </footer>
    <div class="center">
      &middot;
    </div>


      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-45739616-1', 'auto');
        ga('require', 'displayfeatures');
        ga('send', 'pageview');
      </script>
  </body>
</html>
