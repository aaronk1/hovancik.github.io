<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Free automated code reviews using Pronto</title>
      <meta name="description" content="Jan Hovancik, software developer - guitar player - poetry lover">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta property="og:image" content='http://hovancik.net/img/wood-817459_1280.jpg'/>
      <link href='//fonts.googleapis.com/css?family=Tienne:700,400|Poiret+One|Roboto:300' rel='stylesheet' type='text/css'>
      <link href="http://hovancik.net/blog/feed.xml" rel="alternate" title="RSS" type="application/rss+xml" />
      <link href="../../../../../css/normalize.css" rel="stylesheet" />
      <link href="../../../../../css/main.css" rel="stylesheet" />
      <link href="../../../../../img/favicon.ico" rel="icon" type="image/ico" />
  </head>
  <body>

          <div class="blog">
      <div class="blog__nav">
        <p>
          <a href="/">hovancik.net</a>/<a href="/blog">blog</a>/
        </p>
      </div>
        <article>
    <div>
      <h1>
        <a href="">Free automated code reviews using Pronto</a>
      </h1>
      <p>
        <small>Posted under
          <a href="/blog/tags/ruby/">ruby</a>
                    <a href="/blog/tags/rubocop/">rubocop</a>
                    <a href="/blog/tags/pronto/">pronto</a>
                    <a href="/blog/tags/reviews/">reviews</a>
                    <a href="/blog/tags/code-style/">code style</a>
           on
          <time>Apr 11 2016</time>
        </small>
      </p>
    </div>
    <div class="center">
      &middot;
    </div>
    <div class="article_text">
    <h2>Code style</h2>

<p>Officially or unofficially, every dev team has it&rsquo;s <a href="https://en.wikipedia.org/wiki/Programming_style">code style</a>. And hopefully, the means to enforce it, as well.</p>

<p><em>De facto</em> standard way to enforce it is via pull requests where some other team member will check your code for violations so you can fix&#39;em.</p>

<p>So the obvious questions come:</p>

<ul>
<li><strong>is there any generally accepted code style?</strong></li>
<li><strong>can that be automated?</strong></li>
</ul>

<p>Yes and yes. Depending on language used.</p>

<h4>Language</h4>

<p>Here, we will be talking about <a href="https://www.ruby-lang.org/en/">Ruby</a>.</p>

<p>It does not have official guide, but there is community driven one at <a href="https://github.com/bbatsov/ruby-style-guide">GitHub</a>  documenting Ruby coding style and best practices.</p>

<h4>Tools</h4>

<p>There are some paid tools that we could use like <a href="https://codacy.com/">Codacy</a> or <a href="https://houndci.com/">HoundCI</a>, but as title says, we would like to use something free, so here comes <a href="https://github.com/mmozuras/pronto">Pronto</a>.</p>

<blockquote>
<p>Pronto runs analysis quickly by checking only the relevant changes. Created to be used on pull requests, but also works locally. Perfect if want to find out quickly if branch introduces changes that conform to your styleguide, are DRY, don&rsquo;t introduce security holes and more.</p>
</blockquote>

<h3>Scenario</h3>

<p>For the sake of this article, let&rsquo;s assume the following workflow:</p>

<ul>
<li>create code locally (let&rsquo;s say Rails app)</li>
<li>push code to Github</li>
<li>create pull request on Github</li>
<li>get some tests running via TravisCI or CircleCI</li>
<li>prosper</li>
</ul>

<h2>Getting ready</h2>

<p>Assuming we are on Rails, let&rsquo;s create new branch and add the following gems to Gemfile.</p>

<pre><code>group :development, :test do
  # Pronto
  gem &#39;pronto&#39;
  gem &#39;pronto-rubocop&#39;, require: false
end
</code></pre>

<p>We need to add <code>pronto</code> gem, so we can include some of its runners like <code>pronto-rubocop</code>. Runners are various tools and libraries that actually check the code. <a href="https://github.com/bbatsov/rubocop">Rubocop</a> checks the usage of previously mentioned Ruby style.</p>

<p>We should not require them, as some of them might be using monkey-patching to do their job. As we wanna run them only locally and on CI only, the best practice is to add them to <code>group :development, :test</code>.</p>

<h3>Bad code.</h3>

<p>Let&rsquo;s write some bad code.</p>

<pre><code>class Bad
  def what
    &quot;Not&quot;
    &#39;Cool&#39;
  end
end
</code></pre>

<p>Now we can <code>pronto run</code>  and see some recommendations from rubocop.</p>

<pre><code>bad.rb:1 I: Missing top-level class documentation comment.
bad.rb:3 W: Literal `&quot;Not&quot;` used in void context.
bad.rb:3 I: Prefer single-quoted strings when you don&#39;t need string interpolation or special symbols.
</code></pre>

<p>Nice.</p>

<h2>Running on CI and Github</h2>

<p>Running locally is great, but we wanna comment on PRs, right?</p>

<h3>Neat-freak</h3>

<p>To be able to comment on PRs, we need to act as some person. We can either use some existing one, but I think that the best way is to create new one.</p>

<p>Once we have one, we will need its <a href="https://github.com/settings/tokens">Personal Access Token</a>. Generate one and paste it to ENV variable (or however you do it). Obviously it&rsquo;s not something to share.</p>

<p>We will use it in config file <code>.pronto.yml</code></p>

<pre><code>github:
  slug: user-name/repo
  access_token: ENV[&quot;GITHUB_ACCESS_TOKEN&quot;]
  api_endpoint: https://api.github.com/
  web_endpoint: https://github.com/
max_warnings: 150
verbose: false
</code></pre>

<p>Next we add our new guy as contributor to <code>repo</code>.</p>

<p>Sweet. Neat Freak can now comment on Github. (We should not forget to add this value to our CI service as well. )</p>

<h3>TravisCI</h3>

<p>Now let&rsquo;s configure good old Travis via <code>.travis.yml</code>.</p>

<pre><code>script:
  - bundle exec rake test
  - &#39;PULL_REQUEST_ID=${TRAVIS_PULL_REQUEST} bundle exec pronto run -f github_pr&#39;
</code></pre>

<p>We&#39;e just told Travis to run pronto after tests. <code>TRAVIS_PULL_REQUEST</code> is the same as GH&rsquo;s pull request id, so we are cool.</p>

<h3>CircleCI</h3>

<p>In case you are using CircleCI, you will need to add something like this to <code>circle.yml</code>.</p>

<pre><code>test:
  post:
    - &#39;PULL_REQUEST_ID=${CI_PULL_REQUEST##*/} bundle exec pronto run -f github_pr&#39;
</code></pre>

<p>CircleCI doesn&rsquo;t store GH&rsquo;s pull request id, so we used a bit of magic to get it from <code>CI_PULL_REQUEST</code>.</p>

<h3>Once again</h3>

<p>Do not forget to add <code>GITHUB_ACCESS_TOKEN</code> to your CI service.</p>

<h2>Push vs Pull Request</h2>

<p>In TravisCI, you can set whether you want to run your tests on pull requests and/or pushes.<br>
Obviously, with pushes you will get errors because there is no <code>TRAVIS_PULL_REQUEST</code>.</p>

<p>Here is little fix:  </p>

<pre><code>- &#39;if [ &quot;$TRAVIS_PULL_REQUEST&quot; == false ]; then echo &quot;TRAVIS_PULL_REQUEST is unset, skipping Pronto&quot;; else PULL_REQUEST_ID=${TRAVIS_PULL_REQUEST} bundle exec pronto run -f github_pr; fi&#39;

</code></pre>

<h2>Profit</h2>

<p>Now we can see comments in PR&rsquo;s once code style problems are found. And of course we can configure style guide. To see how, just go see how runners/respective tools do it.</p>

    </div>
    <div class="center">
      &middot;
    </div>
    <p class="social">
      Did you enjoy this? Copy-paste the link from the address bar
      to your favourite social network to share. Subscribe
      <a href="//feeds.feedburner.com/JanHovancik">here</a>.
    </p>
    <div class="center">
      &middot;
    </div>
    <div id='disqus_thread'></div>
<script type='text/javascript'>
//<![CDATA[
                  var disqus_shortname = 'hovancik';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
<a href='http://disqus.com' class='dsq-brlink'>comments powered by <span class='logo-disqus'>Disqus</span></a>

    <div class="center">
      &middot;
    </div>
  </article>

    </div>
    <footer>
      <p class="footer__name"><a href="/">Jan Hovancik</a> 2014+</p>
      <p class="footer__desc">
        software developer - guitar player - poetry lover
      </p>
    </footer>
    <div class="center">
      &middot;
    </div>


      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-45739616-1', 'auto');
        ga('require', 'displayfeatures');
        ga('send', 'pageview');
      </script>
  </body>
</html>
